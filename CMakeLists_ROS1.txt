# Copyright(c) 2019 livoxtech limited.
cmake_minimum_required(VERSION 3.0)

include(cmake/version.cmake)
project(livox_ros_driver2 VERSION ${LIVOX_ROS_DRIVER2_VERSION} LANGUAGES CXX)
message(STATUS "livox_ros_driver2 version: ${LIVOX_ROS_DRIVER2_VERSION}")

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

add_definitions(-DBUILDING_ROS1) # build for ROS1

## make sure the livox_lidar_sdk_static library is installed
# find_library(LIVOX_LIDAR_SDK_LIBRARY liblivox_lidar_sdk_static.a /usr/local/lib)
find_library(LIVOX_LIDAR_SDK_LIBRARY liblivox_lidar_sdk_static.so /usr/local/lib)

# ## PCL library
# link_directories(${PCL_LIBRARY_DIRS})
# add_definitions(${PCL_DEFINITIONS})

#---------------------------------------------------------------------------------------
# find package and the dependecy
#---------------------------------------------------------------------------------------
find_package(Boost 1.54 REQUIRED COMPONENTS
  system
  thread
  chrono
)

find_package(catkin REQUIRED COMPONENTS
  roscpp
  rospy
  sensor_msgs
  std_msgs
  message_generation
  rosbag
  pcl_ros
  mrs_lib
  nodelet
)

find_package(PCL REQUIRED)

find_package(PkgConfig)
pkg_check_modules(APR apr-1)

## Generate messages in the 'msg' folder
add_message_files(FILES
  CustomPoint.msg
  CustomMsg.msg
)

## Generate added messages and services with any dependencies listed here
generate_messages(DEPENDENCIES
  std_msgs
)

SET(LIBRARIES
  LivoxROSDriver2
)

catkin_package(
  # INCLUDE_DIRS include
  LIBRARIES ${LIBRARIES}
  CATKIN_DEPENDS roscpp rospy std_msgs message_runtime pcl_ros mrs_lib nodelet
  # DEPENDS Eigen
)

include_directories(
  ${catkin_INCLUDE_DIRS}
  ${PCL_INCLUDE_DIRS}
  3rdparty
  src
)

link_directories(${PCL_LIBRARY_DIRS})
add_definitions(${PCL_DEFINITIONS})


# Library LivoxROSDriver2
add_library(LivoxROSDriver2
  src/livox_ros_driver2.cpp
  src/driver_node.cpp
  src/lds.cpp
  src/lds_lidar.cpp
  src/lddc.cpp
  src/livox_ros_driver2.cpp
  src/comm/comm.cpp
  src/comm/ldq.cpp
  src/comm/semaphore.cpp
  src/comm/lidar_imu_data_queue.cpp
  src/comm/cache_index.cpp
  src/comm/pub_handler.cpp
  src/parse_cfg_file/parse_cfg_file.cpp
  src/parse_cfg_file/parse_livox_lidar_cfg.cpp
  src/call_back/lidar_common_callback.cpp
  src/call_back/livox_lidar_callback.cpp
)

add_dependencies(LivoxROSDriver2
  ${${PROJECT_NAME}_EXPORTED_TARGETS}
  ${catkin_EXPORTED_TARGETS}
)

target_link_libraries(LivoxROSDriver2 
  ${LIVOX_LIDAR_SDK_LIBRARY}
  ${Boost_LIBRARY}
  ${catkin_LIBRARIES}
  ${PCL_LIBRARIES}
  ${APR_LIBRARIES}
)

# target_include_directories(LivoxROSDriver2
#   PUBLIC
#   ${catkin_INCLUDE_DIRS}
#   ${PCL_INCLUDE_DIRS}
#   ${APR_INCLUDE_DIRS}
#   3rdparty
#   src
# )

# #---------------------------------------------------------------------------------------
# # precompile macro and compile option
# #---------------------------------------------------------------------------------------
# # target_compile_options(${PROJECT_NAME}_node
# #   PRIVATE $<$<CXX_COMPILER_ID:GNU>:-Wall>
# # )

# #---------------------------------------------------------------------------------------
# # add projects that depend on
# #---------------------------------------------------------------------------------------
# add_dependencies(${PROJECT_NAME}_node ${PROJECT_NAME}_generate_messages_cpp)

# #---------------------------------------------------------------------------------------
# # source file
# #---------------------------------------------------------------------------------------
# target_sources(${PROJECT_NAME}_node
#   PRIVATE
#   src/driver_node.cpp
#   src/lds.cpp
#   src/lds_lidar.cpp
#   src/lddc.cpp
#   src/livox_ros_driver2.cpp

#   src/comm/comm.cpp
#   src/comm/ldq.cpp
#   src/comm/semaphore.cpp
#   src/comm/lidar_imu_data_queue.cpp
#   src/comm/cache_index.cpp
#   src/comm/pub_handler.cpp

#   src/parse_cfg_file/parse_cfg_file.cpp
#   src/parse_cfg_file/parse_livox_lidar_cfg.cpp

#   src/call_back/lidar_common_callback.cpp
#   src/call_back/livox_lidar_callback.cpp
# )

# #---------------------------------------------------------------------------------------
# # include file
# #---------------------------------------------------------------------------------------
# include_directories(
#   ${catkin_INCLUDE_DIRS}
#   src/include
# )

# target_include_directories(${PROJECT_NAME}_node
#   PUBLIC
#   ${catkin_INCLUDE_DIRS}
#   ${PCL_INCLUDE_DIRS}
#   ${APR_INCLUDE_DIRS}
#   3rdparty
#   src
# )

# #---------------------------------------------------------------------------------------
# # link libraries
# #---------------------------------------------------------------------------------------
# target_link_libraries(${PROJECT_NAME}_node
#   ${LIVOX_LIDAR_SDK_LIBRARY}
#   ${Boost_LIBRARY}
#   ${catkin_LIBRARIES}
#   ${PCL_LIBRARIES}
#   ${APR_LIBRARIES}
# )


#---------------------------------------------------------------------------------------
# Install
#---------------------------------------------------------------------------------------
install(TARGETS ${LIBRARIES}
  ARCHIVE DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  LIBRARY DESTINATION ${CATKIN_PACKAGE_LIB_DESTINATION}
  RUNTIME DESTINATION ${CATKIN_GLOBAL_BIN_DESTINATION}
  )

install(DIRECTORY launch config
  DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}
  )

install(FILES nodelets.xml
  DESTINATION ${CATKIN_PACKAGE_SHARE_DESTINATION}
  )

#---------------------------------------------------------------------------------------
# end of CMakeList.txt
#---------------------------------------------------------------------------------------
